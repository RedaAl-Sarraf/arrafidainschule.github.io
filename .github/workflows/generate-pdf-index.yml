name: Generate PDF index

on:
  push:
    paths:
      - 'pdfs/**.pdf'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate index.html for each folder
        run: |
          for dir in pdfs/*/; do
            year=$(basename "$dir")
            {
              echo "<!DOCTYPE html>"
              echo "<html lang='ar' dir='rtl'>"
              echo "<head>"
              echo "<meta charset='UTF-8' />"
              echo "<meta name='viewport' content='width=device-width, initial-scale=1' />"
              echo "<title>الواجبات البيتية $year - مَدْرَسَةُ الرَّافِدَينِ العَرَبِيَّة</title>"
              echo "<link rel='stylesheet' href='../../style.css' />"
              echo "<link rel='icon' type='image/png' sizes='32x32' href='../../logo/favicon-32x32.png'>"
              echo "</head>"
              echo "<body>"
              
              # HEADER
              echo "<header>"
              echo "  <div class='logo' onclick=\"window.location.href='../../index.html'\">"
              echo "    مَدْرَسَةُ الرَّافِدَينِ العَرَبِيَّة"
              echo "    <img src='../../logo/ArraRundLogo.png' alt='Logo' class='school-logo' />"
              echo "  </div>"
              echo "  <nav>"
              echo "    <div class='hamburger' onclick='toggleMenu()'>☰</div>"
              echo "    <ul id='menu'>"
              echo "      <li><a href='../../index.html'>الصفحة الرئيسية</a></li>"
              echo "      <li><a href='../../hausaufgaben.html'>الواجبات البيتية</a></li>"
              echo "      <li><a href='../../about.html'>عن المدرسة</a></li>"
              echo "      <li><a href='../../bilder.html'>معرض الصور</a></li>"
              echo "      <li><a href='../../ads.html'>إعلانات</a></li>"
              echo "      <li><a href='../../kontakt.html'>اتصل بنا</a></li>"
              echo "    </ul>"
              echo "  </nav>"
              echo "</header>"

              # SEITENINHALT
              echo "<main>"
              echo "<h1>الواجبات البيتية للعام الدراسي $year</h1>"
              echo "<ul>"
              
              # Sortiere nach Datum im Dateinamen (Format: ddmmyyyy)
              for pdf in $(ls "$dir"*.pdf | sed -E 's/.*([0-9]{8})\.pdf/\1 &/' | sort -r | cut -d' ' -f2); do
                file=$(basename "$pdf")
                echo "<li><a href='$file' target='_blank'>$file</a></li>"
              done

              echo "</ul>"
              echo "<p><a href='../../hausaufgaben.html'>العودة</a></p>"
              echo "</main>"

              # FOOTER
              echo "<footer>"
              echo "  <div class='social-icons'>"
              echo "    <a href='https://www.facebook.com/profile.php?id=100063760595206#' target='_blank' aria-label='Facebook'>"
              echo "      <img src='../../logo/facebook-svgrepo-com.svg' data-hover='../../logo/facebook-svgrepo-com-gold.svg' alt='Facebook' width='24' height='24'>"
              echo "    </a>"
              echo "    <a href='https://www.instagram.com/arrafidain_kulturverein_e.v._/' target='_blank' aria-label='Instagram'>"
              echo "      <img src='../../logo/instagram-svgrepo-com.svg' data-hover='../../logo/instagram-svgrepo-com-gold.svg' alt='Instagram' width='24' height='24'>"
              echo "    </a>"
              echo "    <a href='https://t.me/arrafidainschule' target='_blank' aria-label='Telegram'>"
              echo "      <img src='../../logo/telegram-svgrepo-com.svg' data-hover='../../logo/telegram-svgrepo-com-gold.svg' alt='Telegram' width='24' height='24'>"
              echo "    </a>"
              echo "  </div>"
              echo "</footer>"

              echo "<script src='../../script.js'></script>"
              echo "</body></html>"
            } > "$dir/index.html"
          done

      - name: Commit and push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add pdfs/*/index.html
          git commit -m "Auto-generate PDF indexes" || echo "No changes"
          git push
